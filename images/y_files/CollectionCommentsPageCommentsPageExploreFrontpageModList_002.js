(window.webpackJsonp=window.webpackJsonp||[]).push([["CollectionCommentsPage~CommentsPage~Explore~Frontpage~ModListing~ModQueuePages~ModerationPages~Multi~4425b46d"],{"./node_modules/lodash/_arrayEvery.js":function(e,t){e.exports=function(e,t){for(var i=-1,s=null==e?0:e.length;++i<s;)if(!t(e[i],i,e))return!1;return!0}},"./node_modules/lodash/_baseEvery.js":function(e,t,i){var s=i("./node_modules/lodash/_baseEach.js");e.exports=function(e,t){var i=!0;return s(e,function(e,s,n){return i=!!t(e,s,n)}),i}},"./node_modules/lodash/every.js":function(e,t,i){var s=i("./node_modules/lodash/_arrayEvery.js"),n=i("./node_modules/lodash/_baseEvery.js"),l=i("./node_modules/lodash/_baseIteratee.js"),r=i("./node_modules/lodash/isArray.js"),o=i("./node_modules/lodash/_isIterateeCall.js");e.exports=function(e,t,i){var h=r(e)?s:n;return i&&o(e,t,i)&&(t=void 0),h(e,l(t,3))}},"./node_modules/lodash/uniqueId.js":function(e,t,i){var s=i("./node_modules/lodash/toString.js"),n=0;e.exports=function(e){var t=++n;return s(e)+t}},"./src/reddit/components/Scroller/Simple.tsx":function(e,t,i){"use strict";var s=i("./node_modules/lodash/debounce.js"),n=i.n(s),l=i("./node_modules/lodash/isNil.js"),r=i.n(l),o=i("./node_modules/react/index.js"),h=i.n(o),d=i("./node_modules/react-dom/index.js"),a=i("./node_modules/react-redux/es/index.js"),c=i("./node_modules/request-idle-callback/index.js"),p=i("./node_modules/reselect/lib/index.js"),u=i("./bundled-modules/styled-components/styled-components.min.js"),m=i.n(u),f=i("./src/lib/constants/index.ts"),C=i("./src/lib/fastdom/index.ts"),b=i("./node_modules/lodash/throttle.js"),g=i.n(b);const I=500,v=1e3,w=40;var R;!function(e){e.Max10="0-10",e.Max20="11-20",e.Max30="21-30",e.Max40="31-40",e.Max50="41-50",e.Max60="51-60"}(R||(R={}));const S=()=>({[R.Max10]:0,[R.Max20]:0,[R.Max30]:0,[R.Max40]:0,[R.Max50]:0,[R.Max60]:0}),x=[R.Max10,R.Max20,R.Max30,R.Max40,R.Max50,R.Max60],M=e=>({eventHandler:e});function T({fn:e,subscriber:t,timeout:i}){const s=[];let n,l,r;const o=()=>{if(s.length<w)return;const e=S(),i=Math.min(v,s.length),n=s.splice(0,i);s.splice(0,s.length);const l=n[i-1]-n[0];for(let t=n.shift();n.length>0;t=n.shift()){const i=n[0]-t,s=Math.min(60,Math.ceil(1e3/i));e[s<=10?R.Max10:60===s?R.Max60:x[Math.ceil(s/10)-1]]+=i}const r=S();for(const t in e)r[t]=e[t]/l;t(r)},h=()=>{void 0!==r&&(window.clearTimeout(r),r=void 0)},d=()=>{void 0!==n&&(cancelAnimationFrame(n),n=void 0),void 0!==l&&(window.clearInterval(l),l=void 0),h(),o()},a=()=>{n=requestAnimationFrame(()=>{s.push(performance.now()),a()})},c=g()(()=>{h(),r=window.setTimeout(d,i)},f.L);return{cleanup:d,eventHandler:t=>{void 0===l?(a(),c(),l=window.setInterval(o,I)):c(),e(t)}}}var y=i("./src/lib/scheduler/index.ts"),F=i("./src/lib/domUtils/index.ts"),V=i("./src/lib/LinkedListMap/index.ts");const O=(e,t)=>e<0?t+e:e%t;class P{constructor(e){this.head=0,this.size=0,this.maxSize=e,this.items=new Array(e)}push(e){return this.items[this.head]=e,this.head=O(this.head+1,this.maxSize),this.size<this.maxSize&&this.size++,this}pop(){if(this.size>0){const e=O(this.head-1,this.maxSize),t=this.items[e];return this.items[e]=void 0,this.head=e,this.size--,t}}forEach(e){let t=this.size<this.maxSize?O(this.head-this.size,this.maxSize):this.head;for(let i=0;i<this.size;i++)e(this.items[t],i,this.size),t=(t+1)%this.maxSize}map(e){const t=new Array(this.size);return this.forEach((i,s,n)=>{t[s]=e(i,s,n)}),t}getEntries(){const e=new Array(this.size);return this.forEach((t,i)=>{e[i]=t}),e}clear(){const e=this.size;for(let t=0;t<e;t++)this.pop()}}var E=()=>document.body.scrollTop||document.documentElement.scrollTop||window.pageYOffset||0;class H{constructor({top:e,height:t,heightWithMargin:i}){this.height=t,this.heightWithMargin=i,this.top=e,this.bottom=this.top+this.height}contains(e){return!(e.top<=this.top||e.bottom>=this.bottom)}intersects(e){return!(e.bottom<=this.top||e.top>=this.bottom)}intersectsBorder(e){return e.top<=this.top&&e.bottom>=this.top||e.bottom>=this.bottom&&e.top<=this.bottom}containsTop(e){return!(e.top<this.top||e.top>this.bottom)}isAbove(e){return e.top>this.bottom}isBelow(e){return e.bottom<this.top}}const W=({buffer:e,container:t}={})=>{const i=r()(e)?1e3:e;if("undefined"!=typeof window&&t){const e=t===document?E():t.scrollTop;return new H({top:e,height:window.innerHeight})}return new H({top:0,height:i})};var k,j=i("./src/reddit/constants/componentSizes.ts"),L=i("./src/reddit/constants/elementClassNames.ts"),_=i("./src/reddit/contexts/InsideOverlay.tsx"),z=i("./src/reddit/selectors/platform.ts"),A=i("./src/telemetry/helpers/sendEvent.ts"),U=i("./src/telemetry/helpers/sendTiming.ts"),N=(k="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,function(e,t,i,s){var n=e&&e.defaultProps,l=arguments.length-3;if(t||0===l||(t={}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===l)t.children=s;else if(l>1){for(var o=Array(l),h=0;h<l;h++)o[h]=arguments[h+3];t.children=o}return{$$typeof:k,type:e,key:void 0===i?null:""+i,ref:null,props:t,_owner:null}});const q=j.k,K=5*f.L,B=3,D=Object(p.createStructuredSelector)({isOverlayOpen:z.h}),$=Object(a.connect)(D),J={};function Q(e){let t=0;do{t+=e.offsetTop||0,e=e.offsetParent}while(e);return t}const Y=10,G=.9,X=.9,Z=1.8,ee=5,te=1500,ie=2*f.L,se=400,ne=8,le=5*f.L,re=30,oe="object"==typeof performance&&"function"==typeof performance.now,he=()=>oe?performance.now():Date.now();function de(e,t){return V.a.fromArray(e.children.map((e,i)=>{const s=t&&t.get(e.id);return s?(s.isFocusable=!!e.isFocusable,s.trackOnEnteredViewport=e.trackOnEnteredViewport,s.trackOnExitedViewport=e.trackOnExitedViewport,s):{el:null,id:e.id,index:i,isFocusable:!!e.isFocusable,itemRef:void 0,focused:!1,loaded:!t&&i<ee,rectangle:void 0,trackOnEnteredViewport:e.trackOnEnteredViewport,trackOnExitedViewport:e.trackOnExitedViewport}}),"id")}t.a=m()($(Object(_.b)(class extends h.a.Component{constructor(e){super(e),this.lastRenderPosition=0,this.lastScrollTime=-1,this.resetCanFocusTimer=-1,this.unmountItemsIdleId=null,this.scrollingQuickly=!1,this.visibleChildrenCount=0,this.isRenderableChildrenStateChangePending=!1,this.parentOffsetTop=void 0,this.distanceToTop=void 0,this.measurementsInvalid=!1,this.viewport=void 0,this.mountableViewport=void 0,this.needsToPauseViewportItems=!0,this.updateRenderableChildrenWhenIdleHandle=null,this.requestUpdateWhenIdleCallbackHandle=null,this.pendingScollHandlerRead=null,this.renderableViewport=void 0,this.sendFPSData=(e=>{const t={name:this.props.trackingName};A.b.enqueue(new y.a({args:[e,t],cb:(e,t)=>Object(U.a)(f.o.Redesign,{data:e,meta:t,type:"scrollfps"})}))}),this.getVisibleChildren=(()=>{let e=0;const t=te+(this.props.viewportTopPadding?this.props.viewportTopPadding:0),i=[];let s=this.nextVisibleChildrenIndex;for(;e<t&&s<this.props.children.length;){const t=this.props.children[s];i.push(t),e+=t.estHeight,s++}return this.visibleChildrenCount=i.length,i}),this.setRenderableChildrenIndexIncrement=(()=>{if(this.props.children[0]){const e=this.props.children[0].estHeight;this.renderableChildrenIndexIncrement=Math.min(Math.ceil(se/e),ne)}else this.renderableChildrenIndexIncrement=ne}),this.updateRenderableChildrenWhenIdle=(()=>{this.cancelPopulateRenderableChildrenWhenIdle(),this.hasScrolledWithinThreshold()||(this.timeoutForUpdateIdleCallback=le,Object(c.cancelIdleCallback)(this.requestUpdateWhenIdleCallbackHandle),this.requestUpdateWhenIdleCallbackHandle=Object(c.requestIdleCallback)(()=>{const e=Math.ceil(this.renderableChildrenIndexIncrement/2);this.populateRenderableChildrenFromProps(!1,e)})),this.state.renderableChildren.length<this.props.children.length&&this.schedulePopulateRenderableChildrenWhenIdle()}),this.hasScrolledWithinThreshold=(()=>!!this.lastScrollTime&&he()-this.lastScrollTime<ie),this.populateRenderableChildrenFromProps=((e=!1,t=this.renderableChildrenIndexIncrement,i)=>{const s=i||this.props.children;if(this.state.renderableChildren.length<s.length||e)if(this.hasScrolledWithinThreshold())C.a.read(()=>{clearTimeout(this.updateRenderableChildrenHandle),this.updateRenderableChildrenHandle=setTimeout(()=>{this.populateRenderableChildrenFromProps(e,this.renderableChildrenIndexIncrement,i?s:void 0)},ie)});else{this.nextVisibleChildrenIndex+t<=s.length?this.nextVisibleChildrenIndex+=t:this.nextVisibleChildrenIndex=s.length;const e=s.slice(0,this.nextVisibleChildrenIndex);e.length&&(this.lastVisibleElId=e[e.length-1].id),C.a.write(()=>{this.setState({renderableChildren:e})}),this.isRenderableChildrenStateChangePending=!0}}),this.lastElementIsAboutToBeVisible=(()=>!!(this.lastVisibleEl&&this.lastVisibleEl.getBoundingClientRect().top<window.innerHeight+se)),this.getRenderableChildrenIndexIncrement=((e=re)=>{let t=0,i=this.state.renderableChildren.length;for(;t<e&&i<this.props.children.length;)t+=this.props.children[i].estHeight,i++;const s=i-this.state.renderableChildren.length;return Math.max(this.renderableChildrenIndexIncrement,s)}),this.schedulePopulateRenderableChildrenWhenIdle=(()=>{!this.props.isOverlayOpen||this.props.isOverlay?this.updateRenderableChildrenWhenIdleHandle=setTimeout(()=>{this.updateRenderableChildrenWhenIdle()},this.timeoutForUpdateIdleCallback):this.cancelPopulateRenderableChildrenWhenIdle()}),this.cancelPopulateRenderableChildrenWhenIdle=(()=>{clearTimeout(this.updateRenderableChildrenWhenIdleHandle),Object(c.cancelIdleCallback)(this.requestUpdateWhenIdleCallbackHandle)}),this.callOnScrollForItemsChanged=n()(()=>{this.handleScroll()},f.L),this.pauseAllElements=(()=>{const e=this.getItemsInViewportWithFilter(this.loadedChildRefFilter),t=[];e.forEach(e=>{const i=e.itemRef;i&&(e.focused=!1,t.push(i.pauseContent))}),C.a.write(()=>{t.forEach(e=>e())})}),this.elementIsVisible=(e=>!!this.viewport&&this.viewport.intersects(e)),this.getItemsInViewportWithFilter=(e=>{this.updateViewportInfo();const t=new V.a("id");return this.state.renderableChildren.forEach(i=>{const s=this.childMap.get(i.id);s&&e(s)&&t.push(s)}),t}),this.visibleChildRefFilter=(e=>{const t=this.getChildRectangle(e);return t&&this.elementIsVisible(t)||!1}),this.loadedChildRefFilter=(e=>e.loaded),this.resetScrollFramerateAndFocus=(()=>{this.scrollContainer&&(this.pixelsPerMSRing.clear(),this.lastScrollTime=-1,this.needsToPauseViewportItems=!0,null===this.unmountItemsIdleId&&(this.unmountItemsIdleId=Object(c.requestIdleCallback)(this.unmountItemsWhileIdle)),setTimeout(this.handleScroll,f.L))}),this.setContainerRef=(e=>{this.containerRef=e,this.props.innerRef&&this.props.innerRef(e)}),this.getChildRectangle=(e=>{const t=e.el;if(!t)return;if(e.rectangle&&!this.measurementsInvalid)return e.rectangle;if(void 0===this.parentOffsetTop){const e=t.offsetParent;this.parentOffsetTop=e.offsetTop;const i=e.getBoundingClientRect().top;this.distanceToTop=i+this.getScrollTop()}const i=t.offsetTop+(this.parentOffsetTop||0),s=t.clientHeight,n=`${t.scrollHeight}px`,l=new H({top:i,height:s,heightWithMargin:n});return e.rectangle=l,l}),this.handleResize=(e=>{this.fpsMeter&&this.fpsMeter.eventHandler(e);for(const t in this.hiddenChildren)this.remeasureWhenShown[t]=!0;this.measurementsInvalid=!0,this.callOnScrollForItemsChanged()}),this.handleScroll=(()=>{this.pendingScollHandlerRead||(this.pendingScollHandlerRead=C.a.read(()=>{if(clearTimeout(this.resetCanFocusTimer),this.cancelPopulateRenderableChildrenWhenIdle(),Object(F.b)()||!this.scrollContainer)return void(this.pendingScollHandlerRead=null);this.updateScrollMetrics();const e=this.getAveragePixelsPerMilliSecond(),t=e<G,i=e<X,s=e<Z;if(this.scrollContainer&&!this.loadMoreFired&&this.props.onLoadMore){let e=!1;if(void 0!==this.props.loadMoreToken&&void 0!==this.viewport&&this.nextVisibleChildrenIndex>=this.props.children.length){const t=this.containerRef?Q(this.containerRef):0;e=!!this.containerRef&&this.containerRef.offsetHeight+t-this.viewport.bottom<=this.viewport.height}if(e){const e=this.props.onLoadMore;setTimeout(e),this.loadMoreFired=!0}}this.populateRenderableChildrenIfLastChildIsVisible();const n=new V.a("id");let l,r;const o=[];this.state.renderableChildren.forEach(e=>{const h=this.childMap.get(e.id);let d;if(h&&h.el){if(!(d=this.getChildRectangle(h)))return;const e=h.id;this.elementIsHideable(d)?void 0===this.hiddenChildren[e]&&(this.childrenToHide[e]=d.heightWithMargin):void 0!==this.hiddenChildren[e]&&(this.childrenToShow[e]=!0)}if(!h||!h.el||!h.rectangle)return void(this.measurementsInvalid&&h&&this.getChildRectangle(h));const a=h.id,c=h.itemRef,p=h.trackOnEnteredViewport,u=!!this.itemsInViewport.get(a);if(this.elementIsUnmountable(d))c&&u&&h.loaded&&h.isFocusable&&o.push(c.pauseContent);else if(c&&this.loadItemIfPossible(h,c,t,i,s,o),this.elementIsVisible(d)){n.push(h),!u&&p&&A.b.enqueue(new y.a({cb:p,args:void 0}));const e=this.elementIsFocused(d);e&&!r&&(r=h.id),t&&h.isFocusable&&!l&&e?(l=h.id,h.focused||(h.focused=!0,c&&o.push(c.focusContent))):h.loaded&&h.isFocusable&&(h.focused||this.needsToPauseViewportItems)&&(h.focused=!1,c&&o.push(c.pauseContent))}else u&&h.loaded&&h.isFocusable&&(h.focused=!1,c&&o.push(c.stopContent))}),C.a.write(()=>{o.forEach(e=>e()),this.props.enableElementHiding&&this.hideOrShowChildren()}),this.itemsInViewport.forEach(({id:e,trackOnExitedViewport:t})=>{t&&!n.has(e)&&A.b.enqueue(new y.a({cb:t,args:[!1]}))}),this.itemsInViewport=n,this.canFocusItems=t,this.focusedChild=l,this.primaryChild=r,this.measurementsInvalid=!1,this.needsToPauseViewportItems=!1,t?null===this.unmountItemsIdleId&&(this.unmountItemsIdleId=Object(c.requestIdleCallback)(this.unmountItemsWhileIdle)):(this.resetCanFocusTimer=setTimeout(this.resetScrollFramerateAndFocus,K),null!==this.unmountItemsIdleId&&(Object(c.cancelIdleCallback)(this.unmountItemsIdleId),this.unmountItemsIdleId=null)),this.props.onScroll&&this.props.onScroll({getVisibleItemsInViewport:()=>this.getItemsInViewportWithFilter(this.visibleChildRefFilter),primaryChild:this.primaryChild?this.childMap.get(this.primaryChild):void 0}),this.timeoutForUpdateIdleCallback=4*le,this.schedulePopulateRenderableChildrenWhenIdle(),this.pendingScollHandlerRead=null}))}),this.unmountItemsWhileIdle=(e=>{if(!this.scrollContainer)return;const t=[];if(this.state.renderableChildren.forEach(e=>{const i=this.childMap.get(e.id);if(!i||!i.el||!i.itemRef)return;const s=this.getChildRectangle(i);s&&this.elementIsUnmountable(s)&&i.loaded&&t.push(i)}),!t.length)return;const i=Math.min(Math.ceil(e.timeRemaining()/B),t.length),s=[];for(let n=0;n<i;n++){const e=t[n];s.push(e.itemRef.unmountContent),e.loaded=!1,e.focused=!1}Object(d.unstable_batchedUpdates)(()=>{this.scrollContainer&&s.forEach(e=>e())}),i<t.length?this.unmountItemsIdleId=Object(c.requestIdleCallback)(this.unmountItemsWhileIdle):this.unmountItemsIdleId=null}),this.hideOrShowChildren=n()(()=>{for(const e in this.childrenToHide){const t=this.childrenToHide[e];void 0!==t&&(this.hideChild(e,t),this.childrenToHide[e]=void 0)}for(const e in this.childrenToShow)void 0!==this.childrenToShow[e]&&(this.showChild(e),this.childrenToShow[e]=void 0)},f.L),this.hideChild=((e,t)=>{const i=this.childMap.get(e);if(!i||!i.el)return;const s=i.el.firstChild;s&&(t!==i.el.style.height&&(i.el.style.height=t),s.classList.add(L.e),this.hiddenChildren[e]=`${t}px`,i.loaded&&C.a.write(()=>{i.itemRef&&i.itemRef.unmountContent()}))}),this.showChild=(e=>{const t=this.childMap.get(e);if(!t||!t.el)return;const i=t.el.firstChild;i&&(this.remeasureWhenShown[t.id]&&(this.measurementsInvalid=!0,this.remeasureWhenShown[t.id]=void 0),t.el.style.height=null,i.classList.remove(L.e),void 0!==this.hiddenChildren[e]&&(this.hiddenChildren[e]=void 0))}),this.getStylesForOuterWrapper=(e=>{if(void 0!==this.hiddenChildren[e])return{height:this.hiddenChildren[e]}}),this.remeasureChild=(e=>{this.measurementsInvalid=!0}),this.scrollToChild=((e,t)=>{this.measurementsInvalid=!0,C.a.read(()=>{const i=this.childMap.get(e);if(i&&i.el&&this.scrollContainer){if(i.rectangle=void 0,t&&this.isScrollChildTopVisible(e))return;const s=this.getScrollTop()+i.el.getBoundingClientRect().top-(this.props.scrollToChildPadding||0)-(this.props.viewportTopPadding||0);setTimeout(()=>{this.scrollContainer&&(Object(F.c)(this.scrollContainer,s),this.callOnScrollForItemsChanged())},f.L)}})}),this.isScrollChildTopVisible=(e=>{const t=this.childMap.get(e);if(t&&t.el&&this.scrollContainer){var i=this.props,s=i.scrollToChildPadding;const e=void 0===s?0:s;var n=i.viewportTopPadding;const l=void 0===n?0:n,r=window.innerHeight-l,o=t.el.getBoundingClientRect().top;return o>=l+e&&o<r}return!1}),this.childMap=de(e),this.containerRef=null,this.itemsInViewport=new V.a("id"),this.loadMoreFired=!1,this.pixelsPerMSRing=new P(Y),this.wrapperRefFNs={},this.childRefFns={},this.childrenToHide={},this.childrenToShow={},this.canFocusItems=!0,this.focusedChild=void 0,this.hiddenChildren={},this.nextVisibleChildrenIndex=0,this.lastVisibleEl=null,this.lastVisibleElId=null,this.remeasureWhenShown={},this.timeoutForUpdateIdleCallback=le;const t=this.getVisibleChildren();t.length&&(this.lastVisibleElId=t[t.length-1].id),this.nextVisibleChildrenIndex=t.length,this.updateRenderableChildrenHandle=null,this.state={renderableChildren:t},this.setRenderableChildrenIndexIncrement(),this.validateScrollPreservationProps(e),this.validateLoadMoreProps(e)}populateRenderableChildrenIfLastChildIsVisible(){this.isRenderableChildrenStateChangePending||this.state.renderableChildren.length<this.props.children.length&&C.a.read(()=>{if(!this.isRenderableChildrenStateChangePending&&this.lastElementIsAboutToBeVisible()){const e=this.getRenderableChildrenIndexIncrement();this.populateRenderableChildrenFromProps(!1,e)}})}setupScrollHandler(){this.fpsMeter=this.props.trackingName?T({fn:this.handleScroll,subscriber:this.sendFPSData,timeout:K}):M(this.handleScroll),this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.fpsMeter.eventHandler),window.addEventListener("resize",this.handleResize)}cleanupScrollHandler(){this.fpsMeter&&("function"==typeof this.fpsMeter.cleanup&&this.fpsMeter.cleanup(),this.scrollContainer&&this.scrollContainer.removeEventListener("scroll",this.fpsMeter.eventHandler),window.removeEventListener("resize",this.handleResize),this.pendingScollHandlerRead&&(C.a.clear(this.pendingScollHandlerRead),this.pendingScollHandlerRead=null))}componentDidMount(){this.props.getContainer?this.scrollContainer=this.props.getContainer()||document:this.scrollContainer=document,this.props.onScroll&&this.props.onScroll({getVisibleItemsInViewport:()=>this.getItemsInViewportWithFilter(this.visibleChildRefFilter),primaryChild:void 0}),this.props.disableScrollCache&&!this.props.preventScrollOnMount&&Object(F.c)(this.scrollContainer,0),this.setupScrollHandler(),C.a.write(()=>{if(!this.props.disableScrollCache){const e=this.getCacheKey(),t=J[e];r()(t)||(J[e]=void 0,this.scrollContainer&&Object(F.c)(this.scrollContainer,t))}this.callOnScrollForItemsChanged(),this.props.onLastVisibleChildRendered&&this.props.onLastVisibleChildRendered()}),this.schedulePopulateRenderableChildrenWhenIdle()}componentDidUpdate(e){if(this.isRenderableChildrenStateChangePending=!1,this.measurementsInvalid=!0,this.scrollTargetId&&(this.scrollToChild(this.scrollTargetId,!1),this.scrollTargetId=void 0),this.didLayoutAloneChange(e,this.props)){this.callExitedViewportForUnmount(),this.focusedChild=void 0,this.childrenToShow={},this.childrenToHide={},this.hiddenChildren={},this.childMap.forEach(e=>{e.loaded=!1,e.focused=!1}),this.setRenderableChildrenIndexIncrement(),this.populateRenderableChildrenFromProps(!0),this.callOnScrollForItemsChanged();const e=this.getVisibleChildren();this.visibleChildrenCount=e.length,this.schedulePopulateRenderableChildrenWhenIdle()}this.populateRenderableChildrenIfLastChildIsVisible(),e.trackingName!==this.props.trackingName&&(this.cleanupScrollHandler(),this.setupScrollHandler())}shouldComponentUpdate(e){return e.isOverlayOpen===this.props.isOverlayOpen}componentWillReceiveProps(e){this.validateScrollPreservationProps(e)&&this.validateLoadMoreProps(e)&&this.didLayoutAloneChange(this.props,e)&&this.hasBeenScrolled()&&this.handleScroll(),e.loadMoreToken!==this.props.loadMoreToken&&(this.loadMoreFired=!1,this.loadMoreEl=null),e.isOverlayOpen!==this.props.isOverlayOpen&&e.isOverlayOpen&&!this.props.isOverlay&&C.a.read(this.pauseAllElements),e.isOverlayOpen===this.props.isOverlayOpen||e.isOverlayOpen||this.props.isOverlay||this.resetScrollFramerateAndFocus(),this.childMap=de(e,this.childMap);const t=e.children.length<this.props.children.length,i=e.children.length===this.props.children.length&&e.children.some((e,t)=>e.id!==this.props.children[t].id);this.populateRenderableChildrenFromProps(t||i,this.renderableChildrenIndexIncrement,e.children),this.schedulePopulateRenderableChildrenWhenIdle()}componentWillUnmount(){if(this.callExitedViewportForUnmount(),this.cleanupScrollHandler(),clearTimeout(this.updateRenderableChildrenHandle),this.cancelPopulateRenderableChildrenWhenIdle(),this.scrollContainer&&!this.props.disableScrollCache){const e=this.getCacheKey();J[e]=this.lastRenderPosition}this.childMap=new V.a("id"),this.itemsInViewport=new V.a("id"),this.wrapperRefFNs={},this.childRefFns={},this.containerRef=null,this.loadMoreEl=void 0,this.scrollContainer=void 0,this.unmountItemsIdleId&&(Object(c.cancelIdleCallback)(this.unmountItemsIdleId),this.unmountItemsIdleId=null)}didLayoutAloneChange(e,t){return"string"==typeof e.layoutKey&&"string"==typeof t.layoutKey&&e.layoutKey!==t.layoutKey&&"string"==typeof e.dataKey&&"string"==typeof t.layoutKey&&e.dataKey===t.dataKey}elementIsFocused(e){if(!this.viewport)return!1;const t=this.distanceToTop?this.distanceToTop:0,i=this.parentOffsetTop?this.parentOffsetTop:0,s=e.bottom+t-i,n=e.top+t-i,l=Math.min(this.viewport.bottom,s)-Math.max(this.viewport.top,n),r=l/e.height,o=l/this.viewport.height;return r>.75||o>.9}getFirstItemInViewport(){for(const e of this.props.children){const t=e.id,i=this.childMap.get(t);if(i){const e=this.getChildRectangle(i);if(e&&this.elementIsVisible(e))return i}}}elementIsUnmountable(e){return!!this.mountableViewport&&!this.mountableViewport.intersects(e)}elementIsHideable(e){return!!this.renderableViewport&&!this.renderableViewport.intersects(e)}getCacheKey(){return this.props.children.map(e=>e.id).join("-")}getScrollTop(){return this.scrollContainer?this.scrollContainer===document?E():this.scrollContainer.scrollTop:0}updateViewportInfo(){if(this.scrollContainer){this.viewport=W({buffer:0,container:this.scrollContainer});var e=this.props.viewportTopPadding;const t=void 0===e?0:e,i=window.innerHeight-t,s=2*i;this.mountableViewport=new H({top:this.viewport.top-s,height:this.viewport.height+2*s});const n=4*i;this.renderableViewport=new H({top:this.viewport.top-n,height:this.viewport.height+2*n})}}updateScrollMetrics(){this.updateViewportInfo();const e=he(),t=this.getScrollTop(),i=Math.abs(this.lastRenderPosition-t),s=e-this.lastScrollTime,n=this.lastScrollTime>-1;this.lastScrollTime=e,this.lastRenderPosition=t,n?this.pixelsPerMSRing.push(i/s):this.lastScrollTime=e}getAveragePixelsPerMilliSecond(){if(this.pixelsPerMSRing.size>1){let e=0;return this.pixelsPerMSRing.forEach(t=>e+=t),e/this.pixelsPerMSRing.size}return 0}_wrapperRefFN(e,t){const i=this.childMap.get(e);i&&(i.el=t),this.lastVisibleElId===e&&(this.lastVisibleEl=t)}getWrapperRefFN(e){let t=this.wrapperRefFNs[e];return t||(t=(t=>{this._wrapperRefFN(e,t)}),this.wrapperRefFNs[e]=t),t}_childRefFn(e,t,i){const s=this.childMap.get(e);s&&(s.itemRef=t,s.loaded=!!t&&(void 0!==i?i:s.loaded),this.callOnScrollForItemsChanged())}getChildRefFn(e){let t=this.childRefFns[e];return t||(t=((t,i)=>{this._childRefFn(e,t,i)}),this.childRefFns[e]=t),t}loadItemIfPossible(e,t,i,s,n,l){if(t.contentIsHeavyToMount()?s:n){const s=!e.isFocusable||i;!e.loaded&&s&&(e.loaded=!0,l.push(t.loadContent))}}callExitedViewportForUnmount(){this.itemsInViewport.forEach(({id:e,trackOnExitedViewport:t})=>{t&&A.b.enqueue(new y.a({cb:t,args:[!0]}))})}hasBeenScrolled(){if(!this.containerRef)return!1;var e=this.props.viewportTopPadding;const t=void 0===e?0:e,i=Q(this.containerRef);return this.getScrollTop()+t-i>0}render(){return h.a.createElement("div",{className:this.props.className,ref:this.setContainerRef},this.state.renderableChildren.map((e,t)=>h.a.createElement("div",{key:`scroller-${e.id}`,ref:this.getWrapperRefFN(e.id),style:this.getStylesForOuterWrapper(e.id)},N("div",{className:this.hiddenChildren[e.id]?L.e:void 0},void 0,e.render({className:L.g,height:e.estHeight,placeholderRecommended:!1,remeasure:this.remeasureChild,scrollToAndRemeasure:this.scrollToChild,setScrollerChildRef:this.getChildRefFn(e.id),shouldLoadInitially:t<ee,width:q})))))}validateScrollPreservationProps(e){return"string"!=typeof e.layoutKey||void 0!==e.dataKey}validateLoadMoreProps(e){return void 0===e.onLoadMore||"loadMoreToken"in e}}))).withConfig({componentId:"s1rcgrht-0"})(["."," {display: none;}"],L.e)}}]);
//# sourceMappingURL=CollectionCommentsPage~CommentsPage~Explore~Frontpage~ModListing~ModQueuePages~ModerationPages~Multi~4425b46d.ef25f23b859229c1c743.js.map